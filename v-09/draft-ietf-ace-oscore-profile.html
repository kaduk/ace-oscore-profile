<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" 
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head profile="http://www.w3.org/2006/03/hcard http://dublincore.org/documents/2008/08/04/dc-html/">
  <meta http-equiv="Content-Type" content="text/html; charset=us-ascii" />

  <title>OSCORE profile of the Authentication and Authorization for Constrained Environments Framework</title>

  <style type="text/css" title="Xml2Rfc (sans serif)">
  /*<![CDATA[*/
	  a {
	  text-decoration: none;
	  }
      /* info code from SantaKlauss at http://www.madaboutstyle.com/tooltip2.html */
      a.info {
          /* This is the key. */
          position: relative;
          z-index: 24;
          text-decoration: none;
      }
      a.info:hover {
          z-index: 25;
          color: #FFF; background-color: #900;
      }
      a.info span { display: none; }
      a.info:hover span.info {
          /* The span will display just on :hover state. */
          display: block;
          position: absolute;
          font-size: smaller;
          top: 2em; left: -5em; width: 15em;
          padding: 2px; border: 1px solid #333;
          color: #900; background-color: #EEE;
          text-align: left;
      }
	  a.smpl {
	  color: black;
	  }
	  a:hover {
	  text-decoration: underline;
	  }
	  a:active {
	  text-decoration: underline;
	  }
	  address {
	  margin-top: 1em;
	  margin-left: 2em;
	  font-style: normal;
	  }
	  body {
	  color: black;
	  font-family: verdana, helvetica, arial, sans-serif;
	  font-size: 10pt;
	  max-width: 55em;
	  
	  }
	  cite {
	  font-style: normal;
	  }
	  dd {
	  margin-right: 2em;
	  }
	  dl {
	  margin-left: 2em;
	  }
	
	  ul.empty {
	  list-style-type: none;
	  }
	  ul.empty li {
	  margin-top: .5em;
	  }
	  dl p {
	  margin-left: 0em;
	  }
	  dt {
	  margin-top: .5em;
	  }
	  h1 {
	  font-size: 14pt;
	  line-height: 21pt;
	  page-break-after: avoid;
	  }
	  h1.np {
	  page-break-before: always;
	  }
	  h1 a {
	  color: #333333;
	  }
	  h2 {
	  font-size: 12pt;
	  line-height: 15pt;
	  page-break-after: avoid;
	  }
	  h3, h4, h5, h6 {
	  font-size: 10pt;
	  page-break-after: avoid;
	  }
	  h2 a, h3 a, h4 a, h5 a, h6 a {
	  color: black;
	  }
	  img {
	  margin-left: 3em;
	  }
	  li {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol p {
	  margin-left: 0em;
	  }
	  p {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  pre {
	  margin-left: 3em;
	  background-color: lightyellow;
	  padding: .25em;
	  }
	  pre.text2 {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f0f0f0;
	  width: 69em;
	  }
	  pre.inline {
	  background-color: white;
	  padding: 0em;
	  }
	  pre.text {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  width: 69em;
	  }
	  pre.drawing {
	  border-style: solid;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  padding: 2em;
	  }
	  table {
	  margin-left: 2em;
	  }
	  table.tt {
	  vertical-align: top;
	  }
	  table.full {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.headers {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.tt td {
	  vertical-align: top;
	  }
	  table.full td {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.tt th {
	  vertical-align: top;
	  }
	  table.full th {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.headers th {
	  border-style: none none inset none;
	  border-width: 1px;
	  }
	  table.left {
	  margin-right: auto;
	  }
	  table.right {
	  margin-left: auto;
	  }
	  table.center {
	  margin-left: auto;
	  margin-right: auto;
	  }
	  caption {
	  caption-side: bottom;
	  font-weight: bold;
	  font-size: 9pt;
	  margin-top: .5em;
	  }
	
	  table.header {
	  border-spacing: 1px;
	  width: 95%;
	  font-size: 10pt;
	  color: white;
	  }
	  td.top {
	  vertical-align: top;
	  }
	  td.topnowrap {
	  vertical-align: top;
	  white-space: nowrap; 
	  }
	  table.header td {
	  background-color: gray;
	  width: 50%;
	  }
	  table.header a {
	  color: white;
	  }
	  td.reference {
	  vertical-align: top;
	  white-space: nowrap;
	  padding-right: 1em;
	  }
	  thead {
	  display:table-header-group;
	  }
	  ul.toc, ul.toc ul {
	  list-style: none;
	  margin-left: 1.5em;
	  margin-right: 0em;
	  padding-left: 0em;
	  }
	  ul.toc li {
	  line-height: 150%;
	  font-weight: bold;
	  font-size: 10pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  ul.toc li li {
	  line-height: normal;
	  font-weight: normal;
	  font-size: 9pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  li.excluded {
	  font-size: 0pt;
	  }
	  ul p {
	  margin-left: 0em;
	  }
	
	  .comment {
	  background-color: yellow;
	  }
	  .center {
	  text-align: center;
	  }
	  .error {
	  color: red;
	  font-style: italic;
	  font-weight: bold;
	  }
	  .figure {
	  font-weight: bold;
	  text-align: center;
	  font-size: 9pt;
	  }
	  .filename {
	  color: #333333;
	  font-weight: bold;
	  font-size: 12pt;
	  line-height: 21pt;
	  text-align: center;
	  }
	  .fn {
	  font-weight: bold;
	  }
	  .hidden {
	  display: none;
	  }
	  .left {
	  text-align: left;
	  }
	  .right {
	  text-align: right;
	  }
	  .title {
	  color: #990000;
	  font-size: 18pt;
	  line-height: 18pt;
	  font-weight: bold;
	  text-align: center;
	  margin-top: 36pt;
	  }
	  .vcardline {
	  display: block;
	  }
	  .warning {
	  font-size: 14pt;
	  background-color: yellow;
	  }
	
	
	  @media print {
	  .noprint {
		display: none;
	  }
	
	  a {
		color: black;
		text-decoration: none;
	  }
	
	  table.header {
		width: 90%;
	  }
	
	  td.header {
		width: 50%;
		color: black;
		background-color: white;
		vertical-align: top;
		font-size: 12pt;
	  }
	
	  ul.toc a::after {
		content: leader('.') target-counter(attr(href), page);
	  }
	
	  ul.ind li li a {
		content: target-counter(attr(href), page);
	  }
	
	  .print2col {
		column-count: 2;
		-moz-column-count: 2;
		column-fill: auto;
	  }
	  }
	
	  @page {
	  @top-left {
		   content: "Internet-Draft"; 
	  } 
	  @top-right {
		   content: "December 2010"; 
	  } 
	  @top-center {
		   content: "Abbreviated Title";
	  } 
	  @bottom-left {
		   content: "Doe"; 
	  } 
	  @bottom-center {
		   content: "Expires June 2011"; 
	  } 
	  @bottom-right {
		   content: "[Page " counter(page) "]"; 
	  } 
	  }
	
	  @page:first { 
		@top-left {
		  content: normal;
		}
		@top-right {
		  content: normal;
		}
		@top-center {
		  content: normal;
		}
	  }
  /*]]>*/
  </style>

  <link href="#rfc.toc" rel="Contents">
<link href="#rfc.section.1" rel="Chapter" title="1 Introduction">
<link href="#rfc.section.1.1" rel="Chapter" title="1.1 Terminology">
<link href="#rfc.section.2" rel="Chapter" title="2 Protocol Overview">
<link href="#rfc.section.3" rel="Chapter" title="3 Client-AS Communication">
<link href="#rfc.section.3.1" rel="Chapter" title="3.1 C-to-AS: POST to token endpoint">
<link href="#rfc.section.3.2" rel="Chapter" title="3.2 AS-to-C: Access Token">
<link href="#rfc.section.3.2.1" rel="Chapter" title="3.2.1 OSCORE_Security_Context Object">
<link href="#rfc.section.4" rel="Chapter" title="4 Client-RS Communication">
<link href="#rfc.section.4.1" rel="Chapter" title="4.1 C-to-RS: POST to authz-info endpoint">
<link href="#rfc.section.4.2" rel="Chapter" title="4.2 RS-to-C: 2.01 (Created)">
<link href="#rfc.section.4.3" rel="Chapter" title="4.3 OSCORE Setup">
<link href="#rfc.section.4.4" rel="Chapter" title="4.4 Access rights verification">
<link href="#rfc.section.5" rel="Chapter" title="5 Secure Communication with AS">
<link href="#rfc.section.6" rel="Chapter" title="6 Discarding the Security Context">
<link href="#rfc.section.7" rel="Chapter" title="7 Security Considerations">
<link href="#rfc.section.8" rel="Chapter" title="8 Privacy Considerations">
<link href="#rfc.section.9" rel="Chapter" title="9 IANA Considerations">
<link href="#rfc.section.9.1" rel="Chapter" title="9.1 ACE OAuth Profile Registry">
<link href="#rfc.section.9.2" rel="Chapter" title="9.2 OSCORE Security Context Parameters Registry">
<link href="#rfc.section.9.3" rel="Chapter" title="9.3 CWT Confirmation Methods Registry">
<link href="#rfc.section.9.4" rel="Chapter" title="9.4 JWT Confirmation Methods Registry">
<link href="#rfc.section.9.5" rel="Chapter" title="9.5 Expert Review Instructions">
<link href="#rfc.references" rel="Chapter" title="10 References">
<link href="#rfc.references.1" rel="Chapter" title="10.1 Normative References">
<link href="#rfc.references.2" rel="Chapter" title="10.2 Informative References">
<link href="#rfc.appendix.A" rel="Chapter" title="A Profile Requirements">
<link href="#rfc.acknowledgments" rel="Chapter">
<link href="#rfc.authors" rel="Chapter">


  <meta name="generator" content="xml2rfc version 2.38.1 - https://tools.ietf.org/tools/xml2rfc" />
  <link rel="schema.dct" href="http://purl.org/dc/terms/" />

  <meta name="dct.creator" content="Palombini, F., Seitz, L., Selander, G., and M. Gunnarsson" />
  <meta name="dct.identifier" content="urn:ietf:id:draft-ietf-ace-oscore-profile-latest" />
  <meta name="dct.issued" scheme="ISO8601" content="2020-28" />
  <meta name="dct.abstract" content="This memo specifies a profile for the Authentication and Authorization for Constrained Environments (ACE) framework.  It utilizes Object Security for Constrained RESTful Environments (OSCORE) to provide communication security, server authentication, and proof-of-possession for a key owned by the client and bound to an OAuth 2.0 access token.   " />
  <meta name="description" content="This memo specifies a profile for the Authentication and Authorization for Constrained Environments (ACE) framework.  It utilizes Object Security for Constrained RESTful Environments (OSCORE) to provide communication security, server authentication, and proof-of-possession for a key owned by the client and bound to an OAuth 2.0 access token.   " />

</head>

<body>

  <table class="header">
    <tbody>
    
    	<tr>
<td class="left">ACE Working Group</td>
<td class="right">F. Palombini</td>
</tr>
<tr>
<td class="left">Internet-Draft</td>
<td class="right">Ericsson AB</td>
</tr>
<tr>
<td class="left">Intended status: Standards Track</td>
<td class="right">L. Seitz</td>
</tr>
<tr>
<td class="left">Expires: July 31, 2020</td>
<td class="right">Combitech</td>
</tr>
<tr>
<td class="left"></td>
<td class="right">G. Selander</td>
</tr>
<tr>
<td class="left"></td>
<td class="right">Ericsson AB</td>
</tr>
<tr>
<td class="left"></td>
<td class="right">M. Gunnarsson</td>
</tr>
<tr>
<td class="left"></td>
<td class="right">RISE</td>
</tr>
<tr>
<td class="left"></td>
<td class="right">January 28, 2020</td>
</tr>

    	
    </tbody>
  </table>

  <p class="title">OSCORE profile of the Authentication and Authorization for Constrained Environments Framework<br />
  <span class="filename">draft-ietf-ace-oscore-profile-latest</span></p>
  
  <h1 id="rfc.abstract"><a href="#rfc.abstract">Abstract</a></h1>
<p>This memo specifies a profile for the Authentication and Authorization for Constrained Environments (ACE) framework.  It utilizes Object Security for Constrained RESTful Environments (OSCORE) to provide communication security, server authentication, and proof-of-possession for a key owned by the client and bound to an OAuth 2.0 access token.  </p>
<h1 id="rfc.status"><a href="#rfc.status">Status of This Memo</a></h1>
<p>This Internet-Draft is submitted in full conformance with the provisions of BCP 78 and BCP 79.</p>
<p>Internet-Drafts are working documents of the Internet Engineering Task Force (IETF).  Note that other groups may also distribute working documents as Internet-Drafts.  The list of current Internet-Drafts is at https://datatracker.ietf.org/drafts/current/.</p>
<p>Internet-Drafts are draft documents valid for a maximum of six months and may be updated, replaced, or obsoleted by other documents at any time.  It is inappropriate to use Internet-Drafts as reference material or to cite them other than as "work in progress."</p>
<p>This Internet-Draft will expire on July 31, 2020.</p>
<h1 id="rfc.copyrightnotice"><a href="#rfc.copyrightnotice">Copyright Notice</a></h1>
<p>Copyright (c) 2020 IETF Trust and the persons identified as the document authors.  All rights reserved.</p>
<p>This document is subject to BCP 78 and the IETF Trust's Legal Provisions Relating to IETF Documents (https://trustee.ietf.org/license-info) in effect on the date of publication of this document.  Please review these documents carefully, as they describe your rights and restrictions with respect to this document.  Code Components extracted from this document must include Simplified BSD License text as described in Section 4.e of the Trust Legal Provisions and are provided without warranty as described in the Simplified BSD License.</p>

  
  <hr class="noprint" />
  <h1 class="np" id="rfc.toc"><a href="#rfc.toc">Table of Contents</a></h1>
  <ul class="toc">

  	<li>1.   <a href="#rfc.section.1">Introduction</a>
</li>
<ul><li>1.1.   <a href="#rfc.section.1.1">Terminology</a>
</li>
</ul><li>2.   <a href="#rfc.section.2">Protocol Overview</a>
</li>
<li>3.   <a href="#rfc.section.3">Client-AS Communication</a>
</li>
<ul><li>3.1.   <a href="#rfc.section.3.1">C-to-AS: POST to token endpoint</a>
</li>
<li>3.2.   <a href="#rfc.section.3.2">AS-to-C: Access Token</a>
</li>
<ul><li>3.2.1.   <a href="#rfc.section.3.2.1">OSCORE_Security_Context Object</a>
</li>
</ul></ul><li>4.   <a href="#rfc.section.4">Client-RS Communication</a>
</li>
<ul><li>4.1.   <a href="#rfc.section.4.1">C-to-RS: POST to authz-info endpoint</a>
</li>
<li>4.2.   <a href="#rfc.section.4.2">RS-to-C: 2.01 (Created)</a>
</li>
<li>4.3.   <a href="#rfc.section.4.3">OSCORE Setup</a>
</li>
<li>4.4.   <a href="#rfc.section.4.4">Access rights verification</a>
</li>
</ul><li>5.   <a href="#rfc.section.5">Secure Communication with AS</a>
</li>
<li>6.   <a href="#rfc.section.6">Discarding the Security Context</a>
</li>
<li>7.   <a href="#rfc.section.7">Security Considerations</a>
</li>
<li>8.   <a href="#rfc.section.8">Privacy Considerations</a>
</li>
<li>9.   <a href="#rfc.section.9">IANA Considerations</a>
</li>
<ul><li>9.1.   <a href="#rfc.section.9.1">ACE OAuth Profile Registry</a>
</li>
<li>9.2.   <a href="#rfc.section.9.2">OSCORE Security Context Parameters Registry</a>
</li>
<li>9.3.   <a href="#rfc.section.9.3">CWT Confirmation Methods Registry</a>
</li>
<li>9.4.   <a href="#rfc.section.9.4">JWT Confirmation Methods Registry</a>
</li>
<li>9.5.   <a href="#rfc.section.9.5">Expert Review Instructions</a>
</li>
</ul><li>10.   <a href="#rfc.references">References</a>
</li>
<ul><li>10.1.   <a href="#rfc.references.1">Normative References</a>
</li>
<li>10.2.   <a href="#rfc.references.2">Informative References</a>
</li>
</ul><li>Appendix A.   <a href="#rfc.appendix.A">Profile Requirements</a>
</li>
<li><a href="#rfc.acknowledgments">Acknowledgments</a>
</li>
<li><a href="#rfc.authors">Authors' Addresses</a>
</li>


  </ul>

  <h1 id="rfc.section.1">
<a href="#rfc.section.1">1.</a> <a href="#introduction" id="introduction">Introduction</a>
</h1>
<p id="rfc.section.1.p.1">This memo specifies a profile of the ACE framework <a href="#I-D.ietf-ace-oauth-authz" class="xref">[I-D.ietf-ace-oauth-authz]</a>.  In this profile, a client and a resource server use CoAP <a href="#RFC7252" class="xref">[RFC7252]</a> to communicate.  The client uses an access token, bound to a key (the proof-of-possession key) to authorize its access to the resource server.  In order to provide communication security, proof of possession, and server authentication they use Object Security for Constrained RESTful Environments (OSCORE) <a href="#I-D.ietf-core-object-security" class="xref">[I-D.ietf-core-object-security]</a>.  </p>
<p id="rfc.section.1.p.2">OSCORE specifies how to use CBOR Object Signing and Encryption (COSE) <a href="#RFC8152" class="xref">[RFC8152]</a> to secure CoAP messages.  Note that OSCORE can be used to secure CoAP messages, as well as HTTP and combinations of HTTP and CoAP; a profile of ACE similar to the one described in this document, with the difference of using HTTP instead of CoAP as communication protocol, could be specified analogously to this one.  </p>
<h1 id="rfc.section.1.1">
<a href="#rfc.section.1.1">1.1.</a> <a href="#terminology" id="terminology">Terminology</a>
</h1>
<p id="rfc.section.1.1.p.1">The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "NOT RECOMMENDED", "MAY", and "OPTIONAL" in this document are to be interpreted as described in BCP 14 <a href="#RFC2119" class="xref">[RFC2119]</a> <a href="#RFC8174" class="xref">[RFC8174]</a> when, and only when, they appear in all capitals, as shown here.  </p>
<p id="rfc.section.1.1.p.2">Certain security-related terms such as "authentication", "authorization", "confidentiality", "(data) integrity", "message  authentication code", and "verify" are taken from <a href="#RFC4949" class="xref">[RFC4949]</a>.  </p>
<p id="rfc.section.1.1.p.3">RESTful terminology follows HTTP <a href="#RFC7231" class="xref">[RFC7231]</a>.  </p>
<p id="rfc.section.1.1.p.4">Terminology for entities in the architecture is defined in OAuth 2.0 <a href="#RFC6749" class="xref">[RFC6749]</a>, such as client (C), resource server (RS), and authorization server (AS). It is assumed in this document that a given resource on a specific RS is associated to a unique AS.  </p>
<p id="rfc.section.1.1.p.5">Concise Data Definition Language (CDDL) <a href="#RFC8610" class="xref">[RFC8610]</a> is used in this specification.  </p>
<p id="rfc.section.1.1.p.6">Note that the term "endpoint" is used here, as in <a href="#I-D.ietf-ace-oauth-authz" class="xref">[I-D.ietf-ace-oauth-authz]</a>, following its OAuth definition, which is to denote resources such as token and introspect at the AS and authz-info at the RS.  The CoAP <a href="#RFC7252" class="xref">[RFC7252]</a> definition, which is "An entity participating in the CoAP protocol" is not used in this memo.  </p>
<h1 id="rfc.section.2">
<a href="#rfc.section.2">2.</a> Protocol Overview</h1>
<p id="rfc.section.2.p.1">This section gives an overview on how to use the ACE Framework <a href="#I-D.ietf-ace-oauth-authz" class="xref">[I-D.ietf-ace-oauth-authz]</a> to secure the communication between a client and a resource server using OSCORE <a href="#I-D.ietf-core-object-security" class="xref">[I-D.ietf-core-object-security]</a>. The parameters needed by the client to negotiate the use of this profile with the authorization server, as well as OSCORE setup process, are described in detail in the following sections.  </p>
<p id="rfc.section.2.p.2">This profile requires a client to retrieve an access token from the AS for the resource it wants to access on a RS, using the token endpoint, as specified in section 5.6 of <a href="#I-D.ietf-ace-oauth-authz" class="xref">[I-D.ietf-ace-oauth-authz]</a>.  To determine the AS in charge of a resource hosted at the RS, the client C MAY send an initial Unauthorized Resource Request message to the RS. The RS then denies the request and sends the address of its AS back to the client C as specified in section 5.1 of <a href="#I-D.ietf-ace-oauth-authz" class="xref">[I-D.ietf-ace-oauth-authz]</a>. The access token request and response MUST be confidentiality-protected and ensure authenticity.  This profile RECOMMENDS the use of OSCORE between client and AS, but TLS or DTLS MAY be used additionally or instead.  </p>
<p id="rfc.section.2.p.3">Once the client has retrieved the access token, it generates a nonce N1 and posts both the token and N1 to the RS using the authz-info endpoint and mechanisms specified in section 5.8 of <a href="#I-D.ietf-ace-oauth-authz" class="xref">[I-D.ietf-ace-oauth-authz]</a> and Content-Format = application/ace+cbor.  </p>
<p id="rfc.section.2.p.4">If the access token is valid, the RS replies to this request with a 2.01 (Created) response with Content-Format = application/ace+cbor, which contains a nonce N2 in a CBOR map. Moreover, the server concatenates N1 with N2 and appends the result to the Master Salt in the Security Context (see section 3 of <a href="#I-D.ietf-core-object-security" class="xref">[I-D.ietf-core-object-security]</a>). The RS then derives the complete Security Context associated with the received token from it plus the parameters received in the AS, following section 3.2 of <a href="#I-D.ietf-core-object-security" class="xref">[I-D.ietf-core-object-security]</a>.  </p>
<p id="rfc.section.2.p.5">After receiving the nonce N2, the client concatenates it with N1 and appends the result to the Master Salt in its Security Context (see section 3 of <a href="#I-D.ietf-core-object-security" class="xref">[I-D.ietf-core-object-security]</a>). The client then derives the complete Security Context from the nonces plus the parameters received from the AS.  </p>
<p id="rfc.section.2.p.6">Finally, the client sends a request protected with OSCORE to the RS. If the request verifies, then this Security Context is stored in the server, and used in the response, and in further communications with the client, until token expiration. This Security Context is discarded if the same token is re-used to successfully derive a new Security Context.  </p>
<p id="rfc.section.2.p.7">The use of random nonces during the exchange prevents the reuse of AEAD nonces and keys with different messages, in case of re-derivation of the Security Context both for Clients and Resource Servers from an old non-expired access token, e.g. in case of re-boot of either the client or RS. In fact, by using random nonces as part of the Master Salt, the request to the authz-info endpoint posting the same token results in a different Security Context, since, even though the Master Secret, Sender ID and Recipient ID are the same, the Master Salt is different. Therefore, the main requirement for the nonces is that they have a good amount of randomness. If random nonces were not used, a node re-using a non-expired old token would be susceptible to on-path attackers provoking the creation of OSCORE messages using old AEAD keys and nonces.  </p>
<p id="rfc.section.2.p.8">An overview of the profile flow for the OSCORE profile is given in <a href="#prof-overview" class="xref">Figure 1</a>.  </p>
<div id="rfc.figure.1"></div>
<div id="prof-overview"></div>
<pre>
   C                            RS                   AS
   | [-- Resource Request ---&gt;] |                     |
   |                            |                     |
   | [&lt;---- AS Request  ------] |                     |
   |      Creation Hints        |                     |
   |                            |                     |
   | ----- POST /token  ----------------------------&gt; |
   |                            |                     |
   | &lt;---------------------------- Access Token ----- |
   |                           + Access Information   |
   | ---- POST /authz-info ---&gt; |                     |
   |     (access_token, N1)     |                     |
   |                            |                     |
   | &lt;--- 2.01 Created (N2) --- |                     |
   |                            |                     |
 /Sec Context             /Sec Context                |
   Derivation/              Derivation/               |
   |                            |                     |
   | ---- OSCORE Request -----&gt; |                     |
   |                            |                     |
   | &lt;--- OSCORE Response ----- |                     |
   |                            |                     |
   | ---- OSCORE Request -----&gt; |                     |
   |                            |                     |
   | &lt;--- OSCORE Response ----- |                     |
   |           ...              |                     |

        </pre>
<p class="figure">Figure 1: Protocol Overview</p>
<h1 id="rfc.section.3">
<a href="#rfc.section.3">3.</a> <a href="#client-as" id="client-as">Client-AS Communication</a>
</h1>
<p id="rfc.section.3.p.1">The following subsections describe the details of the POST request and response to the token endpoint between client and AS. Section 3.2 of <a href="#I-D.ietf-core-object-security" class="xref">[I-D.ietf-core-object-security]</a> defines how to derive a Security Context based on a shared master secret and a set of other parameters, established between client and server, which the client receives from the AS in this exchange.  The proof-of-possession key (pop-key) provisioned from the AS MUST be used as master secret in OSCORE.  </p>
<h1 id="rfc.section.3.1">
<a href="#rfc.section.3.1">3.1.</a> <a href="#c-as" id="c-as">C-to-AS: POST to token endpoint</a>
</h1>
<p id="rfc.section.3.1.p.1">The client-to-AS request is specified in Section 5.6.1 of <a href="#I-D.ietf-ace-oauth-authz" class="xref">[I-D.ietf-ace-oauth-authz]</a>.  </p>
<p id="rfc.section.3.1.p.2">The client MUST send this POST request to the token endpoint over a secure channel that guarantees authentication, message integrity and confidentiality (see <a href="#introsp" class="xref">Section 5</a>).  </p>
<p id="rfc.section.3.1.p.3">An example of such a request, with payload in CBOR diagnostic notation without the tag and value abbreviations is reported in <a href="#ex0" class="xref">Figure 2</a> </p>
<div id="rfc.figure.2"></div>
<div id="ex0"></div>
<pre>
    Header: POST (Code=0.02)
    Uri-Host: "as.example.com"
    Uri-Path: "token"
    Content-Format: "application/ace+cbor"
    Payload:
    {
      "req_aud" : "tempSensor4711",
      "scope" : "read"
     }

          </pre>
<p class="figure">Figure 2: Example C-to-AS POST /token request for an access token bound to a symmetric key.</p>
<p id="rfc.section.3.1.p.4">If the client wants to update its access rights without changing an existing OSCORE Security Context, it MUST include in its POST request to the token endpoint a req_cnf object. The req_cnf MUST include a kid field carrying a CBOR array object containing the client's identifier (assigned in section <a href="#as-c" class="xref">Section 3.2</a>) and optionally the context identifier (if assigned in section <a href="#as-c" class="xref">Section 3.2</a>). The CBOR array is defined in <a href="#kid" class="xref">Figure 3</a>, and follows the notation of <a href="#RFC8610" class="xref">[RFC8610]</a>. These identifiers can be used by the AS to determine the shared secret bound to the proof-of-possession token and therefore MUST identify a symmetric key that was previously generated by the AS as a shared secret for the communication between the client and the RS. The AS MUST verify that the received value identifies a proof-of-possession key that has previously been issued to the requesting client. If that is not the case, the Client-to-AS request MUST be declined with the error code 'invalid_request' as defined in Section 5.6.3 of <a href="#I-D.ietf-ace-oauth-authz" class="xref">[I-D.ietf-ace-oauth-authz]</a>.  </p>
<div id="rfc.figure.3"></div>
<div id="kid"></div>
<pre>
    kid = [ 
      clientId, 
      ?IdContext
      ]

          </pre>
<p class="figure">Figure 3: CDDL Notation of kid for Update of Access Rights</p>
<p id="rfc.section.3.1.p.5">An example of such a request, with payload in CBOR diagnostic notation without the tag and value abbreviations is reported in <a href="#ex7" class="xref">Figure 4</a> </p>
<div id="rfc.figure.4"></div>
<div id="ex7"></div>
<pre>
    Header: POST (Code=0.02)
    Uri-Host: "as.example.com"
    Uri-Path: "token"
    Content-Format: "application/ace+cbor"
    Payload:
    {
      "req_aud" : "tempSensor4711",
      "scope" : "write",
      "req_cnf" : {
        "kid" : ["myclient","contextid1"]
     }

          </pre>
<p class="figure">Figure 4: Example C-to-AS POST /token request for updating rights to an access token bound to a symmetric key.</p>
<h1 id="rfc.section.3.2">
<a href="#rfc.section.3.2">3.2.</a> <a href="#as-c" id="as-c">AS-to-C: Access Token</a>
</h1>
<p id="rfc.section.3.2.p.1">After verifying the POST request to the token endpoint and that the client is authorized to obtain an access token corresponding to its access token request, the AS responds as defined in section 5.6.2 of <a href="#I-D.ietf-ace-oauth-authz" class="xref">[I-D.ietf-ace-oauth-authz]</a>. If the client request was invalid, or not authorized, the AS returns an error response as described in section 5.6.3 of <a href="#I-D.ietf-ace-oauth-authz" class="xref">[I-D.ietf-ace-oauth-authz]</a>.  </p>
<p id="rfc.section.3.2.p.2">The AS can signal that the use of OSCORE is REQUIRED for a specific access token by including the "profile" parameter with the value "coap_oscore" in the access token response.  This means that the client MUST use OSCORE towards all resource servers for which this access token is valid, and follow <a href="#oscore-setup" class="xref">Section 4.3</a> to derive the security context to run OSCORE.  Usually it is assumed that constrained devices will be pre-configured with the necessary profile, so that this kind of profile negotiation can be omitted.  </p>
<p id="rfc.section.3.2.p.3">Moreover, the AS MUST provision the following data: </p>
<p></p>

<ul>
<li>a master secret</li>
<li>a server identifier</li>
</ul>

<p> </p>
<p id="rfc.section.3.2.p.5">Additionally, the AS MAY provision the following data, in the same response.  </p>
<p></p>

<ul>
<li>a client identifier</li>
<li>a context identifier</li>
<li>an AEAD algorithm</li>
<li>an HKDF algorithm</li>
<li>a salt</li>
<li>a replay window type and size</li>
</ul>

<p> </p>
<p id="rfc.section.3.2.p.7">The OSCORE_Security_Context is a CBOR map object, defined in <a href="#oscore-sec-ctx" class="xref">Section 3.2.1</a>.  The master secret MUST be communicated as the 'ms' field in the OSCORE_Security_Context field in the 'cnf' parameter of the access token response as defined in Section 3.2 of <a href="#I-D.ietf-ace-oauth-params" class="xref">[I-D.ietf-ace-oauth-params]</a>.  The AEAD algorithm MAY be included as the 'alg' parameter in the OSCORE_Security_Context; the HKDF algorithm MAY be included as the 'hkdf' parameter of the OSCORE_Security_Context, a salt MAY be included as the 'salt' parameter of the OSCORE_Security_Context, and the replay window type and size MAY be included as the 'rpl' of the OSCORE_Security_Context, as defined in <a href="#oscore-sec-ctx" class="xref">Section 3.2.1</a>.  </p>
<p id="rfc.section.3.2.p.8">The same parameters MUST be included as metadata of the access token. This profile RECOMMENDS the use of CBOR web token (CWT) as specified in  <a href="#RFC8392" class="xref">[RFC8392]</a>. If the token is a CWT, the same OSCORE_Security_Context structure defined above MUST be placed in the 'cnf' claim of this token.  </p>
<p id="rfc.section.3.2.p.9">The AS MUST also assign an identifier to the RS (serverId), MAY assign an identifier to the client (clientId), and MAY assign an identifier to the context (contextId). These identifiers are then used as Sender ID, Recipient ID and ID Context in the OSCORE context as described in section 3.1 of <a href="#I-D.ietf-core-object-security" class="xref">[I-D.ietf-core-object-security]</a>.  The couple (client identifier, context identifier) MUST be unique in the set of all clients on a single RS.  Moreover, when assigned, serverId, clientId and contextId MUST be included in the OSCORE_Security_Context, as defined in <a href="#oscore-sec-ctx" class="xref">Section 3.2.1</a>.  </p>
<p id="rfc.section.3.2.p.10">We assume in this document that a resource is associated to one single AS, which makes it possible to assume unique identifiers for each client requesting a particular resource to a RS.  If this is not the case, collisions of identifiers may appear in the RS, in which case the RS needs to have a mechanism in place to disambiguate identifiers or mitigate their effect.  </p>
<p id="rfc.section.3.2.p.11">Note that in <a href="#oscore-setup" class="xref">Section 4.3</a> C sets the Sender ID of its Security Context to the clientId value received and the Recipient ID to the serverId value, and RS does the opposite.  </p>
<p><a href="#ex1" class="xref">Figure 5</a> shows an example of such an AS response, with payload in CBOR diagnostic notation without the tag and value abbreviations.  </p>
<div id="rfc.figure.5"></div>
<div id="ex1"></div>
<pre>
    Header: Created (Code=2.01)
    Content-Type: "application/ace+cbor"
    Payload:
    {
      "access_token" : h'a5037674656d7053656e73 ...'
       (remainder of access token omitted for brevity)',
      "profile" : "coap_oscore",
      "expires_in" : "3600",
      "cnf" : {
        "OSCORE_Security_Context" : {
          "alg" : "AES-CCM-16-64-128",
          "clientId" : b64'qA',
          "serverId" : b64'Qg',
          "ms" : h'f9af838368e353e78888e1426bd94e6f' 
        }
      }
    }

          </pre>
<p class="figure">Figure 5: Example AS-to-C Access Token response with OSCORE profile.</p>
<p><a href="#ex2" class="xref">Figure 6</a> shows an example CWT, containing the necessary OSCORE parameters in the 'cnf' claim, in CBOR diagnostic notation without tag and value abbreviations.  </p>
<div id="rfc.figure.6"></div>
<div id="ex2"></div>
<pre>
  {
    "aud" : "tempSensorInLivingRoom",
    "iat" : "1360189224",
    "exp" : "1360289224",
    "scope" :  "temperature_g firmware_p",
    "cnf" : {
      "OSCORE_Security_Context" : {
        "alg" : "AES-CCM-16-64-128",
        "clientId" : h'636C69656E74',
        "serverId" : h'736572766572',
        "ms" : h'f9af838368e353e78888e1426bd94e6f' 
    }
  }

          </pre>
<p class="figure">Figure 6: Example CWT with OSCORE parameters.</p>
<p id="rfc.section.3.2.p.14">The same CWT token as in <a href="#ex2" class="xref">Figure 6</a>, using the value abbreviations defined in <a href="#I-D.ietf-ace-oauth-authz" class="xref">[I-D.ietf-ace-oauth-authz]</a> and <a href="#I-D.ietf-ace-cwt-proof-of-possession" class="xref">[I-D.ietf-ace-cwt-proof-of-possession]</a> and encoded in CBOR is shown in <a href="#ex2-cbor" class="xref">Figure 7</a>.  </p>
<p id="rfc.section.3.2.p.15">NOTE TO THE RFC EDITOR: before publishing, it should be checked (and in case fixed) that the values used below (which are not yet registered) are the final values registered in IANA.  </p>
<div id="rfc.figure.7"></div>
<div id="ex2-cbor"></div>
<pre>
A5                                      # map(5)
   03                                   # unsigned(3)
   76                                   # text(22)
      74656D7053656E736F72496E4C6976696E67526F6F6D 
                                        # "tempSensorInLivingRoom"
   06                                   # unsigned(6)
   1A 5112D728                          # unsigned(1360189224)
   04                                   # unsigned(4)
   1A 51145DC8                          # unsigned(1360289224)
   09                                   # unsigned(9)
   78 18                                # text(24)
      74656D70657261747572655F67206669726D776172655F70 
                                        # "temperature_g firmware_p"
   08                                   # unsigned(8)
   A1                                   # map(1)
      04                                # unsigned(4)
      A4                                # map(4)
         05                             # unsigned(5)
         0A                             # unsigned(10)
         02                             # unsigned(2)
         46                             # bytes(6)
            636C69656E74                # "client"
         03                             # unsigned(3)
         46                             # bytes(6)
            736572766572                # "server"
         01                             # unsigned(1)
         50                             # bytes(16)
            F9AF838368E353E78888E1426BD94E6F 
                                        # "\xF9\xAF\x83\x83h\xE3S\xE7
                                           \x88\x88\xE1Bk\xD9No"


          </pre>
<p class="figure">Figure 7: Example CWT with OSCORE parameters.</p>
<p id="rfc.section.3.2.p.16">If the client has requested an update to its access rights using the same OSCORE Security Context, which is valid and authorized, the AS MUST omit the 'cnf' parameter in the response, and MUST carry the client identifier and optionally the context identifier in the 'kid' field in the 'cnf' parameter of the token, with the same structure defined in <a href="#kid" class="xref">Figure 3</a>. These identifiers need to be provisioned, in order for the RS to identify the previously generated Security Context.  </p>
<p><a href="#ex5" class="xref">Figure 8</a> shows an example of such an AS response, with payload in CBOR diagnostic notation without the tag and value abbreviations.  </p>
<div id="rfc.figure.8"></div>
<div id="ex5"></div>
<pre>
    Header: Created (Code=2.01)
    Content-Type: "application/ace+cbor"
    Payload:
    {
      "access_token" : h'a5037674656d7053656e73 ...'
       (remainder of access token omitted for brevity)',
      "profile" : "coap_oscore",
      "expires_in" : "3600"
    }

          </pre>
<p class="figure">Figure 8: Example AS-to-C Access Token response with OSCORE profile, for update of access rights.</p>
<p><a href="#ex6" class="xref">Figure 9</a> shows an example CWT, containing the necessary OSCORE parameters in the 'cnf' claim for update of access rights, in CBOR diagnostic notation without tag and value abbreviations.  </p>
<div id="rfc.figure.9"></div>
<div id="ex6"></div>
<pre>
  {
    "aud" : "tempSensorInLivingRoom",
    "iat" : "1360189224",
    "exp" : "1360289224",
    "scope" :  "temperature_h",
    "cnf" : {
      "kid" : b64'qA'
    }
  }

          </pre>
<p class="figure">Figure 9: Example CWT with OSCORE parameters for update of access rights.</p>
<h1 id="rfc.section.3.2.1">
<a href="#rfc.section.3.2.1">3.2.1.</a> <a href="#oscore-sec-ctx" id="oscore-sec-ctx">OSCORE_Security_Context Object</a>
</h1>
<p id="rfc.section.3.2.1.p.1">An OSCORE_Security_Context is an object that represents part or all of an OSCORE Security Context (Section 3.1 of <a href="#I-D.ietf-core-object-security" class="xref">[I-D.ietf-core-object-security]</a>).  The OSCORE_Security_Context object can either be encoded as JSON object or as CBOR map. In both cases, the set of common parameters that can appear in an OSCORE_Security_Context object can be found in the IANA "OSCORE Security Context Parameters" registry (Section <a href="#sec-ctx-params-reg" class="xref">Section 9.2</a>) and is defined below.  All parameters are optional.  <a href="#table-key-labels" class="xref">Table 1</a> provides a summary of the OSCORE_Security_Context parameters defined in this section.  </p>
<div id="rfc.table.1"></div>
<div id="table-key-labels"></div>
<table cellpadding="3" cellspacing="0" class="tt full center">
<caption>OSCORE_Security_Context Parameters</caption>
<thead><tr>
<th class="left">name</th>
<th class="left">CBOR label</th>
<th class="left">CBOR type</th>
<th class="left">registry</th>
<th class="left">description</th>
</tr></thead>
<tbody>
<tr>
<td class="left">ms</td>
<td class="left">1</td>
<td class="left">bstr</td>
<td class="left"></td>
<td class="left">OSCORE Master Secret value</td>
</tr>
<tr>
<td class="left">clientId</td>
<td class="left">2</td>
<td class="left">bstr</td>
<td class="left"></td>
<td class="left">OSCORE Sender ID value of the client, OSCORE Recipient ID value of the server</td>
</tr>
<tr>
<td class="left">serverId</td>
<td class="left">3</td>
<td class="left">bstr</td>
<td class="left"></td>
<td class="left">OSCORE Sender ID value of the server, OSCORE Recipient ID value of the client</td>
</tr>
<tr>
<td class="left">hkdf</td>
<td class="left">4</td>
<td class="left">bstr / int</td>
<td class="left">COSE Algorithm Values (HMAC-based)</td>
<td class="left">OSCORE HKDF value</td>
</tr>
<tr>
<td class="left">alg</td>
<td class="left">5</td>
<td class="left">tstr / int</td>
<td class="left">COSE Algorithm Values (AEAD)</td>
<td class="left">OSCORE AEAD Algorithm value</td>
</tr>
<tr>
<td class="left">salt</td>
<td class="left">6</td>
<td class="left">bstr</td>
<td class="left"></td>
<td class="left">OSCORE Master Salt value</td>
</tr>
<tr>
<td class="left">contextId</td>
<td class="left">7</td>
<td class="left">bstr</td>
<td class="left"></td>
<td class="left">OSCORE ID Context value</td>
</tr>
<tr>
<td class="left">rpl</td>
<td class="left">8</td>
<td class="left">bstr / int</td>
<td class="left"></td>
<td class="left">OSCORE Replay Window Type and Size</td>
</tr>
</tbody>
</table>
<p></p>

<dl>
<dt>ms:</dt>
<dd style="margin-left: 8">This parameter identifies the OSCORE Master Secret value, which is a byte string. For more information about this field, see section 3.1 of <a href="#I-D.ietf-core-object-security" class="xref">[I-D.ietf-core-object-security]</a>.  In JSON, the "ms" value is a Base64 encoded byte string.  In CBOR, the "ms" type is bstr, and has label 1.  </dd>
<dt>clientId:</dt>
<dd style="margin-left: 8">This parameter identifies a client identifier as a byte string. This identifier is used as OSCORE Sender ID in the client and OSCORE Recipient ID in the server. For more information about this field, see section 3.1 of <a href="#I-D.ietf-core-object-security" class="xref">[I-D.ietf-core-object-security]</a>.  In JSON, the "clientId" value is a Base64 encoded byte string.  In CBOR, the "clientId" type is bstr, and has label 2.  </dd>
<dt>serverId:</dt>
<dd style="margin-left: 8">This parameter identifies a server identifier as a byte string. This identifier is used as OSCORE Sender ID in the server and OSCORE Recipient ID in the client. For more information about this field, see section 3.1 of <a href="#I-D.ietf-core-object-security" class="xref">[I-D.ietf-core-object-security]</a>.  In JSON, the "serverId" value is a Base64 encoded byte string.  In CBOR, the "serverId" type is bstr, and has label 3.  </dd>
<dt>hkdf:</dt>
<dd style="margin-left: 8">This parameter identifies the OSCORE HKDF Algorithm. For more information about this field, see section 3.1 of <a href="#I-D.ietf-core-object-security" class="xref">[I-D.ietf-core-object-security]</a>.  The values used MUST be registered in the IANA "COSE Algorithms" registry and MUST be HMAC-based HKDF algorithms. The value can either be the integer or the text string value of the HMAC-based HKDF algorithm in the "COSE Algorithms" registry.  In JSON, the "hkdf" value is a case-sensitive ASCII string or an integer.  In CBOR, the "hkdf" type is tstr or int, and has label 4.  </dd>
<dt>alg:</dt>
<dd style="margin-left: 8">This parameter identifies the OSCORE AEAD Algorithm. For more information about this field, see section 3.1 of <a href="#I-D.ietf-core-object-security" class="xref">[I-D.ietf-core-object-security]</a> The values used MUST be registered in the IANA "COSE Algorithms" registry and MUST be AEAD algorithms. The value can either be the integer or the text string value of the HMAC-based HKDF algorithm in the "COSE Algorithms" registry.  In JSON, the "alg" value is a case-sensitive ASCII string or an integer.  In CBOR, the "alg" type is tstr or int, and has label 5.  </dd>
<dt>salt:</dt>
<dd style="margin-left: 8">This parameter identifies the OSCORE Master Salt value, which is a byte string. For more information about this field, see section 3.1 of <a href="#I-D.ietf-core-object-security" class="xref">[I-D.ietf-core-object-security]</a>.  In JSON, the "salt" value is a Base64 encoded byte string.  In CBOR, the "salt" type is bstr, and has label 6.  </dd>
<dt>contextId:</dt>
<dd style="margin-left: 8">This parameter identifies the security context as a byte string. This identifier is used as OSCORE ID Context. For more information about this field, see section 3.1 of <a href="#I-D.ietf-core-object-security" class="xref">[I-D.ietf-core-object-security]</a>.  In JSON, the "contextID" value is a Base64 encoded byte string.  In CBOR, the "contextID" type is bstr, and has label 7.  </dd>
<dt>rpl:</dt>
<dd style="margin-left: 8">This parameter is used to carry the OSCORE value, encoded as a bstr.  This parameter identifies the OSCORE Replay Window Size and Type value, which is a byte string. For more information about this field, see section 3.1 of <a href="#I-D.ietf-core-object-security" class="xref">[I-D.ietf-core-object-security]</a>.  In JSON, the "rpl" value is a Base64 encoded byte string.  In CBOR, the "rpl" type is bstr, and has label 8.  </dd>
</dl>

<p> </p>
<p id="rfc.section.3.2.1.p.3">An example of JSON OSCORE_Security_Context is given in <a href="#JSON-osc" class="xref">Figure 10</a>.  </p>
<div id="rfc.figure.10"></div>
<div id="JSON-osc"></div>
<pre>
        "OSCORE_Security_Context" : {
          "alg" : "AES-CCM-16-64-128",
          "clientId" : b64'qA',
          "serverId" : b64'Qg',
          "ms" : b64'+a+Dg2jjU+eIiOFCa9lObw'
        }
  
            </pre>
<p class="figure">Figure 10: Example JSON OSCORE_Security_Context object</p>
<p id="rfc.section.3.2.1.p.4">The CDDL grammar describing the CBOR OSCORE_Security_Context object is: </p>
<pre>
OSCORE_Security_Context = {
    ? 1 =&gt; bstr,              ; ms
    ? 2 =&gt; bstr,              ; clientId
    ? 3 =&gt; bstr,              ; serverId
    ? 4 =&gt; tstr / int,        ; hkdf
    ? 5 =&gt; tstr / int,        ; alg
    ? 6 =&gt; bstr,              ; salt
    ? 7 =&gt; bstr,              ; contextId
    ? 8 =&gt; bstr / tstr,       ; rpl
    * int / tstr =&gt; any
}
</pre>
<h1 id="rfc.section.4">
<a href="#rfc.section.4">4.</a> <a href="#c-rs1" id="c-rs1">Client-RS Communication</a>
</h1>
<p id="rfc.section.4.p.1">The following subsections describe the details of the POST request and response to the authz-info endpoint between client and RS. The client generates a nonce N1 and posts it together with the token that includes the materials provisioned by the AS to the RS. The RS then derives a nonce N2 and use Section 3.2 of <a href="#I-D.ietf-core-object-security" class="xref">[I-D.ietf-core-object-security]</a> to derive a security context based on a shared master secret and the two nonces, established between client and server.  </p>
<p id="rfc.section.4.p.2">Note that the proof-of-possession required to bind the access token to the client is implicitly performed by generating the shared OSCORE Security Context using the pop-key as master secret, for both client and RS.  An attacker using a stolen token will not be able to generate a valid OSCORE context and thus not be able to prove possession of the pop-key.  </p>
<h1 id="rfc.section.4.1">
<a href="#rfc.section.4.1">4.1.</a> <a href="#c-rs" id="c-rs">C-to-RS: POST to authz-info endpoint</a>
</h1>
<p id="rfc.section.4.1.p.1">The client MUST generate a nonce N1 very unlikely to have been previously used with the same input keying material. This profile RECOMMENDS to use a 64-bit long random number as nonce. The client MUST store this nonce as long as the response from the RS is not received and the access token related to it is still valid. The client MUST use CoAP and the Authorization Information resource as described in section 5.8.1 of <a href="#I-D.ietf-ace-oauth-authz" class="xref">[I-D.ietf-ace-oauth-authz]</a> to transport the token and N1 to the RS.  </p>
<p id="rfc.section.4.1.p.2">Note that the use of the payload and the Content-Format is different from what described in section 5.8.1 of <a href="#I-D.ietf-ace-oauth-authz" class="xref">[I-D.ietf-ace-oauth-authz]</a>, which only transports the token without any CBOR wrapping. In this profile, the client MUST wrap the token and N1 in a CBOR map. The client MUST use the Content-Format "application/ace+cbor" defined in section 8.14 of <a href="#I-D.ietf-ace-oauth-authz" class="xref">[I-D.ietf-ace-oauth-authz]</a>. The client MUST include the access token using the correct CBOR label (e.g., "cwt" for CWT, "jwt" for JWT) and N1 using the 'cnonce' parameter defined in section 5.1.2 of <a href="#I-D.ietf-ace-oauth-authz" class="xref">[I-D.ietf-ace-oauth-authz]</a>.  </p>
<p id="rfc.section.4.1.p.3">The authz-info endpoint is not protected, nor are the responses from this resource.  </p>
<p id="rfc.section.4.1.p.4">The access token MUST be encrypted, since it is transferred from the client to the RS over an unprotected channel.  </p>
<p id="rfc.section.4.1.p.5">Note that a client may be required to re-POST the access token, since an RS may delete a stored access token, due to lack of memory.  </p>
<p><a href="#ex3" class="xref">Figure 11</a> shows an example of the request sent from the client to the RS, with payload in CBOR diagnostic notation without the tag and value abbreviations.  </p>
<div id="rfc.figure.11"></div>
<div id="ex3"></div>
<pre>
      Header: POST (Code=0.02)
      Uri-Host: "rs.example.com"
      Uri-Path: "authz-info"
      Content-Format: "application/ace+cbor"
      Payload:
        {
          "access_token": h'a5037674656d7053656e73 ...'
       (remainder of access token omitted for brevity)',
          "cnonce": h'018a278f7faab55a'
        }
  
          </pre>
<p class="figure">Figure 11: Example C-to-RS POST /authz-info request using CWT</p>
<h1 id="rfc.section.4.2">
<a href="#rfc.section.4.2">4.2.</a> <a href="#rs-c" id="rs-c">RS-to-C: 2.01 (Created)</a>
</h1>
<p id="rfc.section.4.2.p.1">The RS MUST follow the procedures defined in section 5.8.1 of <a href="#I-D.ietf-ace-oauth-authz" class="xref">[I-D.ietf-ace-oauth-authz]</a>: the RS MUST verify the validity of the token. If the token is valid, the RS MUST respond to the POST request with 2.01 (Created). If the token is valid but is associated to claims that the RS cannot process (e.g., an unknown scope), or if any of the expected parameters in the OSCORE_Security_Context is missing (e.g. any of the mandatory parameters from the AS), or if any parameters received in the OSCORE_Security_Context is unrecognized, the RS MUST respond with an error response code equivalent to the CoAP code 4.00 (Bad Request). In the latter two cases, the RS MAY provide additional information in the error response, in order to clarify what went wrong.  The RS MAY make an introspection request to validate the token before responding to the POST request to the authz-info endpoint.  </p>
<p id="rfc.section.4.2.p.2">Additionally, the RS MUST generate a nonce N2 very unlikely to have been previously used with the same input keying material, and send it within the 2.01 (Created) response. The payload of the 2.01 (Created) response MUST be a CBOR map containing the 'cnonce' parameter defined in section 5.1.2 of <a href="#I-D.ietf-ace-oauth-authz" class="xref">[I-D.ietf-ace-oauth-authz]</a>, set to N2. This profile RECOMMENDS to use a 64-bit long random number as nonce. Moreover, if the OSCORE_Security_Context in the token did not contain a 'clientId' parameter, the RS MUST generate an identifier, unique in the set of all its existing client identifiers, and send it in a 'clientId' parameter in the CBOR map as a CBOR bstr. The RS MAY generate and send a 'ClientId' identifier even though the OSCORE_Security_Context contained such a parameter, in order to guarantee the uniqueness of the client identifier. The RS MUST use the Content-Format "application/ace+cbor" defined in section 8.14 of <a href="#I-D.ietf-ace-oauth-authz" class="xref">[I-D.ietf-ace-oauth-authz]</a>.  </p>
<p><a href="#ex4" class="xref">Figure 12</a> shows an example of the response sent from the RS to the client, with payload in CBOR diagnostic notation without the tag and value abbreviations.  </p>
<div id="rfc.figure.12"></div>
<div id="ex4"></div>
<pre>
      Header: Created (Code=2.01)
      Content-Format: "application/ace+cbor"
      Payload:
        {
          "cnonce": h'25a8991cd700ac01'
        }
  
          </pre>
<p class="figure">Figure 12: Example RS-to-C 2.01 (Created) response</p>
<p id="rfc.section.4.2.p.4">When receiving an updated access token with updated authorization information from the client (see section <a href="#c-as" class="xref">Section 3.1</a>), it is RECOMMENDED that the RS overwrites the previous token, that is only the latest authorization information in the token received by the RS is valid. This simplifies for the RS to keep track of authorization information for a given client.  </p>
<p id="rfc.section.4.2.p.5">As specified in section 5.8.3 of <a href="#I-D.ietf-ace-oauth-authz" class="xref">[I-D.ietf-ace-oauth-authz]</a>, the RS MUST notify the client with an error response with code 4.01 (Unauthorized) for any long running request before terminating the session, when the access token expires.  </p>
<h1 id="rfc.section.4.3">
<a href="#rfc.section.4.3">4.3.</a> <a href="#oscore-setup" id="oscore-setup">OSCORE Setup</a>
</h1>
<p id="rfc.section.4.3.p.1">Once receiving the 2.01 (Created) response from the RS, following the POST request to authz-info endpoint, the client MUST extract the nonce N2 from the 'cnonce' parameter and the client identifier from the 'clientId' in the CBOR map in the payload of the response. Then, the client MUST set the Master Salt of the Security Context created to communicate with the RS to the concatenation of salt, N1, and N2, in this order: Master Salt = salt | N1 | N2, where | denotes byte string concatenation, and where salt was received from the AS in <a href="#as-c" class="xref">Section 3.2</a>. The client MUST set the Master Secret and Recipient ID from the parameters received from the AS in <a href="#as-c" class="xref">Section 3.2</a>. The client MUST set the AEAD Algorithm, ID Context, HKDF, and Replay Window from the parameters received from the AS in <a href="#as-c" class="xref">Section 3.2</a>, if present. In case these parameters are omitted, the default values are used as described in section 3.2 of <a href="#I-D.ietf-core-object-security" class="xref">[I-D.ietf-core-object-security]</a>. The client MUST set the Sender ID from the 'clientId in the 2.01 (Created) response, if present; otherwise, the client MUST set the Sender ID from the parameters received from the AS in <a href="#as-c" class="xref">Section 3.2</a>. After that, the client MUST derive the complete Security Context following section 3.2.1 of <a href="#I-D.ietf-core-object-security" class="xref">[I-D.ietf-core-object-security]</a>. From this point on, the client MUST use this Security Context to communicate with the RS when accessing the resources as specified by the authorization information.  </p>
<p id="rfc.section.4.3.p.2">If any of the expected parameters is missing (e.g. any of the mandatory parameters from the AS, or the 'clientId', either received from the AS or in the 2.01 (Created) response from the RS), the client MUST stop the exchange, and MUST NOT derive the Security Context. The client MAY restart the exchange, to get the correct security material.  </p>
<p id="rfc.section.4.3.p.3">The client then uses this Security Context to send requests to RS using OSCORE.  </p>
<p id="rfc.section.4.3.p.4">After sending the 2.01 (Created) response, the RS MUST set the Master Salt of the Security Context created to communicate with the client to the concatenation of salt, N1, and N2, in this order: Master Salt = salt | N1 | N2, where | denotes byte string concatenation, and where salt was received from the AS in <a href="#rs-c" class="xref">Section 4.2</a>. The RS MUST set the Master Secret, Sender ID and Recipient ID from the parameters, received from the client in the access token in <a href="#c-rs" class="xref">Section 4.1</a> after validation of the token as specified in <a href="#rs-c" class="xref">Section 4.2</a>. The RS MUST set the AEAD Algorithm, ID Context, HKDF, and Replay Window from the parameters received from the client in the access token in <a href="#c-rs" class="xref">Section 4.1</a> after validation of the token as specified in <a href="#rs-c" class="xref">Section 4.2</a>, if present. In case these parameters are omitted, the default values are used as described in section 3.2 of <a href="#I-D.ietf-core-object-security" class="xref">[I-D.ietf-core-object-security]</a>. After that, the RS MUST derive the complete Security Context following section 3.2.1 of <a href="#I-D.ietf-core-object-security" class="xref">[I-D.ietf-core-object-security]</a>, and MUST associate this Security Context with the authorization information from the access token.  </p>
<p id="rfc.section.4.3.p.5">The RS then uses this Security Context to verify the request and send responses to C using OSCORE. If OSCORE verification fails, error responses are used, as specified in section 8 of <a href="#I-D.ietf-core-object-security" class="xref">[I-D.ietf-core-object-security]</a>. Additionally, if OSCORE verification succeeds, the verification of access rights is performed as described in section <a href="#tok-ver" class="xref">Section 4.4</a>. The RS MUST NOT use the Security Context after the related token has expired, and MUST respond with a unprotected 4.01 (Unauthorized) error message.  </p>
<p id="rfc.section.4.3.p.6">If the exchange was an update of access rights, i.e. a new Security Context was derived from a client that already had a Security Context in place, the is RECOMMENDED to delete the old Security Context after OSCORE verification and verification of access rights succeed. The RS MUST delete the Security Context if it deletes the access token associated to it.  </p>
<h1 id="rfc.section.4.4">
<a href="#rfc.section.4.4">4.4.</a> <a href="#tok-ver" id="tok-ver">Access rights verification</a>
</h1>
<p id="rfc.section.4.4.p.1">The RS MUST follow the procedures defined in section 5.8.2 of <a href="#I-D.ietf-ace-oauth-authz" class="xref">[I-D.ietf-ace-oauth-authz]</a>: if an RS receives an OSCORE-protected request from a client, then the RS processes it according to <a href="#I-D.ietf-core-object-security" class="xref">[I-D.ietf-core-object-security]</a>. If OSCORE verification succeeds, and the target resource requires authorization, the RS retrieves the authorization information from the access token associated to the Security Context. The RS then MUST verify that the authorization information covers the resource and the action requested.  </p>
<p id="rfc.section.4.4.p.2">The response code MUST be 4.01 (Unauthorized) in case the client has not used the Security Context associated with the access token, or if RS has no valid access token for the client.  If RS has an access token for the client but not for the resource that was requested, RS MUST reject the request with a 4.03 (Forbidden).  If RS has an access token for the client but it does not cover the action that was requested on the resource, RS MUST reject the request with a 4.05 (Method Not Allowed).  </p>
<h1 id="rfc.section.5">
<a href="#rfc.section.5">5.</a> <a href="#introsp" id="introsp">Secure Communication with AS</a>
</h1>
<p id="rfc.section.5.p.1">As specified in the ACE framework (section 5.7 of <a href="#I-D.ietf-ace-oauth-authz" class="xref">[I-D.ietf-ace-oauth-authz]</a>), the requesting entity (RS and/or client) and the AS communicates via the introspection or token endpoint. The use of CoAP and OSCORE for this communication is RECOMMENDED in this profile, other protocols (such as HTTP and DTLS or TLS) MAY be used instead.  </p>
<p id="rfc.section.5.p.2">If OSCORE is used, the requesting entity and the AS are expected to have pre-established security contexts in place.  How these security contexts are established is out of scope for this profile.  Furthermore the requesting entity and the AS communicate using OSCORE (<a href="#I-D.ietf-core-object-security" class="xref">[I-D.ietf-core-object-security]</a>) through the introspection endpoint as specified in section 5.7 of <a href="#I-D.ietf-ace-oauth-authz" class="xref">[I-D.ietf-ace-oauth-authz]</a> and through the token endpoint as specified in section 5.6 of <a href="#I-D.ietf-ace-oauth-authz" class="xref">[I-D.ietf-ace-oauth-authz]</a>.  </p>
<h1 id="rfc.section.6">
<a href="#rfc.section.6">6.</a> <a href="#sec-ctx-discard" id="sec-ctx-discard">Discarding the Security Context</a>
</h1>
<p id="rfc.section.6.p.1">There are a number of scenarios where a client or RS needs to discard the OSCORE security context, and acquire a new one.  </p>
<p id="rfc.section.6.p.2">The client MUST discard the current security context associated with an RS when: </p>

<ul>
<li>the Sequence Number space ends. </li>
<li>the access token associated with the context expires. </li>
<li>the client receives a number of 4.01 Unauthorized responses to OSCORE requests using the same security context. The exact number needs to be specified by the application. </li>
<li>the client receives a new nonce in the 2.01 (Created) response (see <a href="#rs-c" class="xref">Section 4.2</a>) to a POST request to the authz-info endpoint, when re-posting a non-expired token associated to the existing context. </li>
</ul>

<p> </p>
<p id="rfc.section.6.p.3">The RS MUST discard the current security context associated with a client when: </p>

<ul>
<li>Sequence Number space ends. </li>
<li>Access token associated with the context expires. </li>
</ul>

<p> </p>
<h1 id="rfc.section.7">
<a href="#rfc.section.7">7.</a> Security Considerations</h1>
<p id="rfc.section.7.p.1">This document specifies a profile for the Authentication and Authorization for Constrained Environments (ACE) framework <a href="#I-D.ietf-ace-oauth-authz" class="xref">[I-D.ietf-ace-oauth-authz]</a>.  Thus the general security considerations from the framework also apply to this profile.  </p>
<p id="rfc.section.7.p.2">Furthermore the general security considerations of OSCORE <a href="#I-D.ietf-core-object-security" class="xref">[I-D.ietf-core-object-security]</a> also apply to this specific use of the OSCORE protocol.  </p>
<p id="rfc.section.7.p.3">OSCORE is designed to secure point-to-point communication, providing a secure binding between the request and the response(s).  Thus the basic OSCORE protocol is not intended for use in point-to-multipoint communication (e.g. multicast, publish-subscribe).  Implementers of this profile should make sure that their usecase corresponds to the expected use of OSCORE, to prevent weakening the security assurances provided by OSCORE.  </p>
<p id="rfc.section.7.p.4">Since the use of nonces in the exchange guarantees uniqueness of AEAD keys and nonces, it is REQUIRED that nonces are not reused with the same input keying material even in case of re-boots. This document RECOMMENDS the use of 64 bit random nonces to guarantee non-reuse; if applications use something else, such as a counter, they need to guarantee that reboot and lost of state on either node does not provoke re-use. If that is not guaranteed, nodes are still susceptible to re-using AEAD nonces and keys, in case the Security Context is lost, and on-path attacker replay messages.  </p>
<p id="rfc.section.7.p.5">This profiles recommends that the RS maintains a single access token for a client. The use of multiple access tokens for a single client increases the strain on the resource server as it must consider every access token and calculate the actual permissions of the client. Also, tokens may contradict each other which may lead the server to enforce wrong permissions. If one of the access tokens expires earlier than others, the resulting permissions may offer insufficient protection. Developers should avoid using multiple access tokens for a client.  </p>
<h1 id="rfc.section.8">
<a href="#rfc.section.8">8.</a> Privacy Considerations</h1>
<p id="rfc.section.8.p.1">This document specifies a profile for the Authentication and Authorization for Constrained Environments (ACE) framework <a href="#I-D.ietf-ace-oauth-authz" class="xref">[I-D.ietf-ace-oauth-authz]</a>.  Thus the general privacy considerations from the framework also apply to this profile.  </p>
<p id="rfc.section.8.p.2">As this document uses OSCORE, thus the privacy considerations from <a href="#I-D.ietf-core-object-security" class="xref">[I-D.ietf-core-object-security]</a> apply here as well.  </p>
<p id="rfc.section.8.p.3">An unprotected response to an unauthorized request may disclose information about the resource server and/or its existing relationship with the client. It is advisable to include as little information as possible in an unencrypted response. When an OSCORE Security Context already exists between the client and the resource server, more detailed information may be included.  </p>
<p id="rfc.section.8.p.4">Note that some information might still leak after OSCORE is established, due to observable message sizes, the source, and the destination addresses.  </p>
<h1 id="rfc.section.9">
<a href="#rfc.section.9">9.</a>  IANA Considerations </h1>
<p id="rfc.section.9.p.1">Note to RFC Editor: Please replace all occurrences of "[[this specification]]" with the RFC number of this specification and delete this paragraph.</p>
<h1 id="rfc.section.9.1">
<a href="#rfc.section.9.1">9.1.</a> ACE OAuth Profile Registry</h1>
<p id="rfc.section.9.1.p.1">The following registration is done for the ACE OAuth Profile Registry following the procedure specified in section 8.7 of <a href="#I-D.ietf-ace-oauth-authz" class="xref">[I-D.ietf-ace-oauth-authz]</a>:</p>
<p></p>

<ul>
<li>Profile name: coap_oscore</li>
<li>Profile Description: Profile for using OSCORE to secure communication between constrained nodes using the Authentication and Authorization for Constrained Environments framework.</li>
<li>Profile ID: TBD (value between 1 and 255)</li>
<li>Change Controller: IESG</li>
<li>Specification Document(s): [[this specification]]</li>
</ul>
<h1 id="rfc.section.9.2">
<a href="#rfc.section.9.2">9.2.</a> <a href="#sec-ctx-params-reg" id="sec-ctx-params-reg">OSCORE Security Context Parameters Registry</a>
</h1>
<p id="rfc.section.9.2.p.1">It is requested that IANA create a new registry entitled "OSCORE Security Context Parameters" registry.  The registry is to be created as Expert Review Required.  Guidelines for the experts is provided <a href="#review" class="xref">Section 9.5</a>.  It should be noted that in addition to the expert review, some portions of the registry require a specification, potentially on standards track, be supplied as well.  </p>
<p id="rfc.section.9.2.p.2">The columns of the registry are: </p>
<p></p>

<dl>
<dt>name</dt>
<dd style="margin-left: 8">The JSON name requested (e.g., "ms").  Because a core goal of this specification is for the resulting representations to be compact, it is RECOMMENDED that the name be short.  This name is case sensitive.  Names may not match other registered names in a case-insensitive manner unless the Designated Experts state that there is a compelling reason to allow an exception.  The name is not used in the CBOR encoding.  </dd>
<dt>CBOR label</dt>
<dd style="margin-left: 8">The value to be used to identify this algorithm.  Key map labels MUST be unique.  The label can be a positive integer, a negative integer or a string.  Integer values between 0 and 255 and strings of length 1 are designated as Standards Track Document required.  Integer values from 256 to 65535 and strings of length 2 are designated as Specification Required.  Integer values of greater than 65535 and strings of length greater than 2 are designated as expert review.  Integer values less than -65536 are marked as private use.  </dd>
<dt>CBOR Type</dt>
<dd style="margin-left: 8">This field contains the CBOR type for the field.  </dd>
<dt>registry</dt>
<dd style="margin-left: 8">This field denotes the registry that values may come from, if one exists.  </dd>
<dt>description</dt>
<dd style="margin-left: 8">This field contains a brief description for the field.  </dd>
<dt>specification</dt>
<dd style="margin-left: 8">This contains a pointer to the public specification for the field if one exists </dd>
</dl>

<p> </p>
<p id="rfc.section.9.2.p.4">This registry will be initially populated by the values in <a href="#table-key-labels" class="xref">Table 1</a>.  The specification column for all of these entries will be this document.  </p>
<h1 id="rfc.section.9.3">
<a href="#rfc.section.9.3">9.3.</a> CWT Confirmation Methods Registry</h1>
<p id="rfc.section.9.3.p.1">The following registration is done for the CWT Confirmation Methods Registry following the procedure specified in section 7.2.1 of <a href="#I-D.ietf-ace-cwt-proof-of-possession" class="xref">[I-D.ietf-ace-cwt-proof-of-possession]</a>:</p>
<p></p>

<ul>
<li>Confirmation Method Name: "OSCORE_Security_Context"</li>
<li>Confirmation Method Description: OSCORE_Security_Context carrying the OSCORE Security Context parameters</li>
<li>Confirmation Key: TBD (value between 4 and 255)</li>
<li>Confirmation Value Type(s): map</li>
<li>Change Controller: IESG</li>
<li>Specification Document(s): <a href="#oscore-sec-ctx" class="xref">Section 3.2.1</a> of [[this specification]]</li>
</ul>
<h1 id="rfc.section.9.4">
<a href="#rfc.section.9.4">9.4.</a> JWT Confirmation Methods Registry</h1>
<p id="rfc.section.9.4.p.1">The following registration is done for the JWT Confirmation Methods Registry following the procedure specified in section 6.2.1 of <a href="#RFC7800" class="xref">[RFC7800]</a>:</p>
<p></p>

<ul>
<li>Confirmation Method Value: "osc"</li>
<li>Confirmation Method Description: OSCORE_Security_Context carrying the OSCORE Security Context parameters</li>
<li>Change Controller: IESG</li>
<li>Specification Document(s): <a href="#oscore-sec-ctx" class="xref">Section 3.2.1</a> of [[this specification]]</li>
</ul>
<h1 id="rfc.section.9.5">
<a href="#rfc.section.9.5">9.5.</a> <a href="#review" id="review">Expert Review Instructions</a>
</h1>
<p id="rfc.section.9.5.p.1">The IANA registry established in this document is defined as expert review.  This section gives some general guidelines for what the experts should be looking for, but they are being designated as experts for a reason so they should be given substantial latitude.  </p>
<p id="rfc.section.9.5.p.2">Expert reviewers should take into consideration the following points: </p>

<ul>
<li>Point squatting should be discouraged.  Reviewers are encouraged to get sufficient information for registration requests to ensure that the usage is not going to duplicate one that is already registered and that the point is likely to be used in deployments.  The zones tagged as private use are intended for testing purposes and closed environments, code points in other ranges should not be assigned for testing.  </li>
<li>Specifications are required for the standards track range of point assignment.  Specifications should exist for specification required ranges, but early assignment before a specification is available is considered to be permissible.  Specifications are needed for the first-come, first-serve range if they are expected to be used outside of closed environments in an interoperable way.  When specifications are not provided, the description provided needs to have sufficient information to identify what the point is being used for.  </li>
<li>Experts should take into account the expected usage of fields when approving point assignment.  The fact that there is a range for standards track documents does not mean that a standards track document cannot have points assigned outside of that range.  The length of the encoded value should be weighed against how many code points of that length are left, the size of device it will be used on, and the number of code points left that encode to that size.  </li>
</ul>

<p> </p>
<h1 id="rfc.references">
<a href="#rfc.references">10.</a> References</h1>
<h1 id="rfc.references.1">
<a href="#rfc.references.1">10.1.</a> Normative References</h1>
<table><tbody>
<tr>
<td class="reference"><b id="I-D.ietf-ace-oauth-authz">[I-D.ietf-ace-oauth-authz]</b></td>
<td class="top">
<a>Seitz, L.</a>, <a>Selander, G.</a>, <a>Wahlstroem, E.</a>, <a>Erdtman, S.</a> and <a>H. Tschofenig</a>, "<a href="https://tools.ietf.org/html/draft-ietf-ace-oauth-authz-31">Authentication and Authorization for Constrained Environments (ACE) using the OAuth 2.0 Framework (ACE-OAuth)</a>", Internet-Draft draft-ietf-ace-oauth-authz-31, January 2020.</td>
</tr>
<tr>
<td class="reference"><b id="I-D.ietf-ace-oauth-params">[I-D.ietf-ace-oauth-params]</b></td>
<td class="top">
<a>Seitz, L.</a>, "<a href="https://tools.ietf.org/html/draft-ietf-ace-oauth-params-11">Additional OAuth Parameters for Authorization in Constrained Environments (ACE)</a>", Internet-Draft draft-ietf-ace-oauth-params-11, January 2020.</td>
</tr>
<tr>
<td class="reference"><b id="I-D.ietf-core-object-security">[I-D.ietf-core-object-security]</b></td>
<td class="top">
<a>Selander, G.</a>, <a>Mattsson, J.</a>, <a>Palombini, F.</a> and <a>L. Seitz</a>, "<a href="https://tools.ietf.org/html/draft-ietf-core-object-security-16">Object Security for Constrained RESTful Environments (OSCORE)</a>", Internet-Draft draft-ietf-core-object-security-16, March 2019.</td>
</tr>
<tr>
<td class="reference"><b id="RFC2119">[RFC2119]</b></td>
<td class="top">
<a>Bradner, S.</a>, "<a href="https://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>", BCP 14, RFC 2119, DOI 10.17487/RFC2119, March 1997.</td>
</tr>
<tr>
<td class="reference"><b id="RFC7252">[RFC7252]</b></td>
<td class="top">
<a>Shelby, Z.</a>, <a>Hartke, K.</a> and <a>C. Bormann</a>, "<a href="https://tools.ietf.org/html/rfc7252">The Constrained Application Protocol (CoAP)</a>", RFC 7252, DOI 10.17487/RFC7252, June 2014.</td>
</tr>
<tr>
<td class="reference"><b id="RFC8152">[RFC8152]</b></td>
<td class="top">
<a>Schaad, J.</a>, "<a href="https://tools.ietf.org/html/rfc8152">CBOR Object Signing and Encryption (COSE)</a>", RFC 8152, DOI 10.17487/RFC8152, July 2017.</td>
</tr>
<tr>
<td class="reference"><b id="RFC8174">[RFC8174]</b></td>
<td class="top">
<a>Leiba, B.</a>, "<a href="https://tools.ietf.org/html/rfc8174">Ambiguity of Uppercase vs Lowercase in RFC 2119 Key Words</a>", BCP 14, RFC 8174, DOI 10.17487/RFC8174, May 2017.</td>
</tr>
<tr>
<td class="reference"><b id="RFC8392">[RFC8392]</b></td>
<td class="top">
<a>Jones, M.</a>, <a>Wahlstroem, E.</a>, <a>Erdtman, S.</a> and <a>H. Tschofenig</a>, "<a href="https://tools.ietf.org/html/rfc8392">CBOR Web Token (CWT)</a>", RFC 8392, DOI 10.17487/RFC8392, May 2018.</td>
</tr>
<tr>
<td class="reference"><b id="RFC8610">[RFC8610]</b></td>
<td class="top">
<a>Birkholz, H.</a>, <a>Vigano, C.</a> and <a>C. Bormann</a>, "<a href="https://tools.ietf.org/html/rfc8610">Concise Data Definition Language (CDDL): A Notational Convention to Express Concise Binary Object Representation (CBOR) and JSON Data Structures</a>", RFC 8610, DOI 10.17487/RFC8610, June 2019.</td>
</tr>
</tbody></table>
<h1 id="rfc.references.2">
<a href="#rfc.references.2">10.2.</a> Informative References</h1>
<table><tbody>
<tr>
<td class="reference"><b id="I-D.ietf-ace-cwt-proof-of-possession">[I-D.ietf-ace-cwt-proof-of-possession]</b></td>
<td class="top">
<a>Jones, M.</a>, <a>Seitz, L.</a>, <a>Selander, G.</a>, <a>Erdtman, S.</a> and <a>H. Tschofenig</a>, "<a href="https://tools.ietf.org/html/draft-ietf-ace-cwt-proof-of-possession-11">Proof-of-Possession Key Semantics for CBOR Web Tokens (CWTs)</a>", Internet-Draft draft-ietf-ace-cwt-proof-of-possession-11, October 2019.</td>
</tr>
<tr>
<td class="reference"><b id="RFC4949">[RFC4949]</b></td>
<td class="top">
<a>Shirey, R.</a>, "<a href="https://tools.ietf.org/html/rfc4949">Internet Security Glossary, Version 2</a>", FYI 36, RFC 4949, DOI 10.17487/RFC4949, August 2007.</td>
</tr>
<tr>
<td class="reference"><b id="RFC6749">[RFC6749]</b></td>
<td class="top">
<a>Hardt, D.</a>, "<a href="https://tools.ietf.org/html/rfc6749">The OAuth 2.0 Authorization Framework</a>", RFC 6749, DOI 10.17487/RFC6749, October 2012.</td>
</tr>
<tr>
<td class="reference"><b id="RFC7231">[RFC7231]</b></td>
<td class="top">
<a>Fielding, R.</a> and <a>J. Reschke</a>, "<a href="https://tools.ietf.org/html/rfc7231">Hypertext Transfer Protocol (HTTP/1.1): Semantics and Content</a>", RFC 7231, DOI 10.17487/RFC7231, June 2014.</td>
</tr>
<tr>
<td class="reference"><b id="RFC7800">[RFC7800]</b></td>
<td class="top">
<a>Jones, M.</a>, <a>Bradley, J.</a> and <a>H. Tschofenig</a>, "<a href="https://tools.ietf.org/html/rfc7800">Proof-of-Possession Key Semantics for JSON Web Tokens (JWTs)</a>", RFC 7800, DOI 10.17487/RFC7800, April 2016.</td>
</tr>
</tbody></table>
<h1 id="rfc.appendix.A">
<a href="#rfc.appendix.A">Appendix A.</a> Profile Requirements</h1>
<p id="rfc.section.A.p.1">This section lists the specifications on this profile based on the requirements on the framework, as requested in Appendix C of <a href="#I-D.ietf-ace-oauth-authz" class="xref">[I-D.ietf-ace-oauth-authz]</a>.  </p>
<p></p>

<ul>
<li>(Optional) discovery process of how the client finds the right AS for an RS it wants to send a request to: Not specified </li>
<li>communication protocol the client and the RS must use: CoAP </li>
<li>security protocol the client and RS must use: OSCORE </li>
<li>how the client and the RS mutually authenticate: Implicitly by possession of a common OSCORE security context </li>
<li>Content-format of the protocol messages: "application/ace+cbor" </li>
<li>proof-of-possession protocol(s) and how to select one; which key types (e.g. symmetric/asymmetric) supported: OSCORE algorithms; pre-established symmetric keys </li>
<li>profile identifier: coap_oscore </li>
<li>(Optional) how the RS talks to the AS for introspection: HTTP/CoAP (+ TLS/DTLS/OSCORE) </li>
<li>how the client talks to the AS for requesting a token: HTTP/CoAP (+ TLS/DTLS/OSCORE) </li>
<li>how/if the authz-info endpoint is protected: Security protocol above </li>
<li>(Optional)other methods of token transport than the authz-info endpoint: no </li>
</ul>

<p> </p>
<h1 id="rfc.acknowledgments"><a href="#rfc.acknowledgments">Acknowledgments</a></h1>
<p id="rfc.section.B.p.1">The authors wish to thank Jim Schaad and Marco Tiloca for the input on this memo.  </p>
<h1 id="rfc.authors"><a href="#rfc.authors">Authors' Addresses</a></h1>
<div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Francesca Palombini</span> 
	  <span class="n hidden">
		<span class="family-name">Palombini</span>
	  </span>
	</span>
	<span class="org vcardline">Ericsson AB</span>
	<span class="adr">
	  
	  <span class="vcardline">
		<span class="locality"></span> 
		<span class="region"></span>
		<span class="code"></span>
	  </span>
	  <span class="country-name vcardline"></span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:francesca.palombini@ericsson.com">francesca.palombini@ericsson.com</a></span>

  </address>
</div><div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Ludwig Seitz</span> 
	  <span class="n hidden">
		<span class="family-name">Seitz</span>
	  </span>
	</span>
	<span class="org vcardline">Combitech</span>
	<span class="adr">
	  <span class="vcardline">Dj&#228;knegatan 31</span>

	  <span class="vcardline">
		<span class="locality">Malm&#246;</span>,  
		<span class="region"></span>
		<span class="code">211 35</span>
	  </span>
	  <span class="country-name vcardline">Sweden</span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:ludwig.seitz@combitech.se">ludwig.seitz@combitech.se</a></span>

  </address>
</div><div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">G&#246;ran Selander</span> 
	  <span class="n hidden">
		<span class="family-name">Selander</span>
	  </span>
	</span>
	<span class="org vcardline">Ericsson AB</span>
	<span class="adr">
	  
	  <span class="vcardline">
		<span class="locality"></span> 
		<span class="region"></span>
		<span class="code"></span>
	  </span>
	  <span class="country-name vcardline"></span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:goran.selander@ericsson.com">goran.selander@ericsson.com</a></span>

  </address>
</div><div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Martin Gunnarsson</span> 
	  <span class="n hidden">
		<span class="family-name">Gunnarsson</span>
	  </span>
	</span>
	<span class="org vcardline">RISE</span>
	<span class="adr">
	  <span class="vcardline">Scheelevagen 17</span>

	  <span class="vcardline">
		<span class="locality">Lund</span>,  
		<span class="region"></span>
		<span class="code">22370</span>
	  </span>
	  <span class="country-name vcardline">Sweden</span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:martin.gunnarsson@ri.se">martin.gunnarsson@ri.se</a></span>

  </address>
</div>

</body>
</html>
